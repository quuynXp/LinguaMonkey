_format_version: "3.0"
_transform: true

services:
  - name: java-service
    url: "http://linguavietnameseapp:8080"
    routes:
      - name: java-service-route
        paths: ["/api/v1"]
        methods: ["GET","POST","PUT","DELETE"]
        protocols: ["http","https"]

consumers:
  - username: svc-client
    custom_id: "client-001"
  - username: admin-client
    custom_id: "admin-001"

plugins:
  - name: jwt
    route: java-service-route
    config:
      key_claim_name: "kid"
      run_on_preflight: true
      maximum_expiration: 86400
      claims_to_verify: ["exp"]
      secret_is_base64: false
      rsa_public_key: |
        -----BEGIN PUBLIC KEY-----
        MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1LNS9rOO1cg//uC3GXvu
        r6HIw9HsDRsU6r+yyV/RjioHLLwasQByDTJhMZfvRJkMmZWKLxam+v8p9tyDLBRa
        /jm+LHrl37ZgRo3EnQeJvJRNWLr0Uahuqez8OLRXAKdydgZWf0B4fJxgN+RsSXP7
        vWNm6idJ0h32M7Obnd8iJDP0+MXdgy2pVd8PUAVFcmS/+7VLcWj1V0gDoMbHscN1
        kswUB8rykRF0m+v5l1jx4ldSX1eKeYoQdznRMjViUTkKuYf5vhTsApgbows5pzs4
        6NxKcxxm2kHLDpa4TKexdSJX9ckDkFAA4Z5ohAwcDvMcwyn0BHJaxIjGtRRwQP+H
        OQIDAQAB
        -----END PUBLIC KEY-----
      algorithm: RS256

  - name: rate-limiting-advanced
    route: java-service-route
    config:
      redis:
        host: "redis"
        port: 6379
        password: "redisPass123"
        database: 0
      policy: "local"
      algorithm: "token_bucket"
      tokens_per_sec: 2.0
      burst: 5
      key: "consumer"
      deny_action: "429"
      response_header: true
